<script src="assets/js/firebase-config.js"></script>
<script src="assets/js/script.js"></script>
<script src="assets/js/apps-data.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', async function() {
        const params = getUrlParams();
        const appId = params.id;
        
        if(!appId) {
            showError('ऐप ID नहीं मिला');
            return;
        }
        
        // Load app from Firebase or cache
        let app = null;
        
        if (typeof FirebaseApp !== 'undefined') {
            app = await FirebaseApp.getAppById(appId);
        }
        
        if (!app) {
            // Try from cache
            const cachedApps = JSON.parse(localStorage.getItem('cached_apps') || '[]');
            app = cachedApps.find(a => a.id == appId);
        }
        
        if(!app) {
            // Try from default apps
            app = window.appsData.find(a => a.id == appId);
        }
        
        if(!app) {
            showError('ऐप नहीं मिला');
            return;
        }
        
        displayAppDetails(app);
    });
    
    async function startDownload(app) {
        const btn = document.getElementById('downloadBtn');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> डाउनलोड हो रहा है...';
        
        // Track download
        await trackDownload(app.id);
        
        // Create download link
        const downloadLink = document.createElement('a');
        downloadLink.href = app.apk_file || '#';
        downloadLink.download = `${app.name.replace(/\s+/g, '_')}.apk`;
        downloadLink.style.display = 'none';
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
        
        // Show success message
        btn.innerHTML = '<i class="fas fa-check"></i> डाउनलोड पूरा हुआ!';
        btn.style.background = '#059669';
        
        setTimeout(() => {
            alert(`धन्यवाद! ${app.name} डाउनलोड शुरू हो गया है।\n\nफाइल: ${app.name.replace(/\s+/g, '_')}.apk\nसाइज: ${app.size || 'N/A'}`);
        }, 500);
    }
</script>