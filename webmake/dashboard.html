<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - WEBSITE MAKER | OP ASHISH YT</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dashboard-page">
    <div class="back-nav">
        <a href="index.html"><i class="fas fa-arrow-left"></i> Home</a>
    </div>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <div class="user-profile">
                <i class="fas fa-user-circle"></i>
                <div>
                    <h2 id="userName">Loading...</h2>
                    <p id="userEmail">Loading...</p>
                </div>
            </div>
            <a href="login.html" class="btn-secondary" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>

        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <h3 id="orderStatus">Loading...</h3>
                <p>Current Status</p>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-receipt"></i>
                </div>
                <h3 id="orderId">N/A</h3>
                <p>Order ID</p>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <h3 id="deliveryTime">Loading...</h3>
                <p>Delivery</p>
            </div>
        </div>

        <div class="dashboard-actions">
            <button id="fillDetailsBtn" class="action-btn primary" style="display: none;">
                <i class="fas fa-edit"></i> Fill Website Details
            </button>
            <button id="makePaymentBtn" class="action-btn warning" style="display: none;">
                <i class="fas fa-rupee-sign"></i> Make Payment
            </button>
            <button id="trackOrderBtn" class="action-btn info" style="display: none;">
                <i class="fas fa-search"></i> Track Order
            </button>
        </div>

        <div class="dashboard-details" id="orderDetails" style="display: none;">
            <h3>üìã Your Order Details</h3>
            <div class="details-grid">
                <div class="detail-item">
                    <span>Website Name:</span>
                    <span id="websiteName">N/A</span>
                </div>
                <div class="detail-item">
                    <span>Business:</span>
                    <span id="businessName">N/A</span>
                </div>
                <div class="detail-item">
                    <span>Services:</span>
                    <span id="servicesList">N/A</span>
                </div>
                <div class="detail-item">
                    <span>Transaction ID:</span>
                    <span id="txnId">N/A</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load user data
        const currentUserId = localStorage.getItem('currentUserId');
        if (!currentUserId) {
            window.location.href = 'login.html';
            return;
        }

        const users = JSON.parse(localStorage.getItem('websiteMakerUsers')) || [];
        const currentUser = users.find(u => u.id == currentUserId);

        if (!currentUser) {
            window.location.href = 'login.html';
            return;
        }

        // Populate dashboard
        function loadDashboard() {
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;

            // Status logic
            const status = getStatusDisplay(currentUser.status);
            document.getElementById('orderStatus').innerHTML = status.icon + ' ' + status.text;
            document.getElementById('orderStatus').className = 'stat-icon ' + status.type;

            if (currentUser.orderId) {
                document.getElementById('orderId').textContent = currentUser.orderId;
            }

            // Calculate delivery time
            if (currentUser.paidAt) {
                const paidDate = new Date(currentUser.paidAt);
                const deliveryDate = new Date(paidDate.getTime() + 24*60*60*1000);
                document.getElementById('deliveryTime').textContent = deliveryDate.toLocaleDateString('hi-IN');
            } else {
                document.getElementById('deliveryTime').textContent = '24 Hours';
            }

            // Show actions based on status
            showActions(currentUser.status);

            // Show details if available
            if (currentUser.details) {
                document.getElementById('websiteName').textContent = currentUser.details.websiteName;
                document.getElementById('businessName').textContent = currentUser.details.businessName;
                document.getElementById('servicesList').textContent = currentUser.details.services;
                document.getElementById('orderDetails').style.display = 'block';
            }

            if (currentUser.txnId) {
                document.getElementById('txnId').textContent = currentUser.txnId;
            }
        }

        function getStatusDisplay(status) {
            const statuses = {
                'registered': { text: 'Details Pending', icon: '‚è≥', type: 'warning' },
                'details_submitted': { text: 'Payment Pending', icon: 'üí≥', type: 'info' },
                'paid': { text: 'Processing (24hr)', icon: 'üîÑ', type: 'warning' },
                'completed': { text: '‚úÖ Delivered!', icon: '‚úÖ', type: 'success' }
            };
            return statuses[status] || { text: 'Unknown', icon: '‚ùì', type: 'danger' };
        }

        function showActions(status) {
            const fillBtn = document.getElementById('fillDetailsBtn');
            const paymentBtn = document.getElementById('makePaymentBtn');
            const trackBtn = document.getElementById('trackOrderBtn');

            fillBtn.style.display = status === 'registered' ? 'block' : 'none';
            paymentBtn.style.display = status === 'details_submitted' ? 'block' : 'none';
            trackBtn.style.display = ['paid', 'completed'].includes(status) ? 'block' : 'none';
        }

        // Event listeners
        document.getElementById('fillDetailsBtn').addEventListener('click', () => {
            window.location.href = 'details.html';
        });

        document.getElementById('makePaymentBtn').addEventListener('click', () => {
            window.location.href = 'payment.html';
        });

        document.getElementById('trackOrderBtn').addEventListener('click', () => {
            alert('‡§Ü‡§™‡§ï‡§æ order processing ‡§Æ‡•á‡§Ç ‡§π‡•à‡•§ 24 ‡§ò‡§Ç‡§ü‡•á ‡§Æ‡•á‡§Ç delivery ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡•Ä!');
        });

        function logout() {
            localStorage.removeItem('currentUserId');
        }

        // Load on page ready
        loadDashboard();
    </script>
</body>
</html>