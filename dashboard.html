<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Ashish Pratap Portfolio</title>
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dashboard-page">
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <div class="header-brand">
                    <span class="header-icon">⚙️</span>
                    <div>
                        <h1>Admin Dashboard</h1>
                        <p class="header-subtitle">Portfolio Management System</p>
                    </div>
                </div>
                
                <div class="header-actions">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="adminUsername">Administrator</span>
                    </div>
                    
                    <button class="btn btn-outline logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </button>
                </div>
            </div>
            
            <div class="dashboard-stats">
                <div class="stat-card">
                    <i class="fas fa-project-diagram"></i>
                    <div>
                        <span class="stat-number" id="projectsCount">0</span>
                        <span class="stat-label">Projects</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-database"></i>
                    <div>
                        <span class="stat-number" id="storageUsed">0KB</span>
                        <span class="stat-label">Storage</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-clock"></i>
                    <div>
                        <span class="stat-number" id="sessionTime">0m</span>
                        <span class="stat-label">Session</span>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- WEBSITE CMS SECTION -->
            <section class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-cogs"></i> Website Content Management</h2>
                    <p>Update all website content and settings</p>
                </div>
                
                <div class="cms-actions">
                    <div class="action-card" onclick="cmsManager.openEditor('basic')">
                        <i class="fas fa-info-circle"></i>
                        <h4>Basic Information</h4>
                        <p>Update name, email, degree</p>
                    </div>
                    
                    <div class="action-card" onclick="cmsManager.openEditor('hero')">
                        <i class="fas fa-home"></i>
                        <h4>Hero Section</h4>
                        <p>Update main banner content</p>
                    </div>
                    
                    <div class="action-card" onclick="cmsManager.openEditor('about')">
                        <i class="fas fa-user"></i>
                        <h4>About Section</h4>
                        <p>Edit personal information</p>
                    </div>
                    
                    <div class="action-card" onclick="cmsManager.openEditor('academics')">
                        <i class="fas fa-graduation-cap"></i>
                        <h4>Academics</h4>
                        <p>Update education timeline</p>
                    </div>
                    
                    <div class="action-card" onclick="cmsManager.openEditor('research')">
                        <i class="fas fa-flask"></i>
                        <h4>Research Areas</h4>
                        <p>Edit research focus</p>
                    </div>
                    
                    <div class="action-card" onclick="cmsManager.openEditor('contact')">
                        <i class="fas fa-envelope"></i>
                        <h4>Contact Info</h4>
                        <p>Update contact details</p>
                    </div>
                    
                    <div class="action-card" onclick="cmsManager.openEditor('social')">
                        <i class="fas fa-share-alt"></i>
                        <h4>Social Media</h4>
                        <p>Manage social links</p>
                    </div>
                    
                    <div class="action-card" onclick="cmsManager.openEditor('appearance')">
                        <i class="fas fa-palette"></i>
                        <h4>Appearance</h4>
                        <p>Change colors & theme</p>
                    </div>
                    
                    <div class="action-card" onclick="cmsManager.openEditor('media')">
                        <i class="fas fa-images"></i>
                        <h4>Media Library</h4>
                        <p>Upload and manage images</p>
                    </div>
                </div>
            </section>
            
            <div class="dashboard-grid">
                <!-- Add Project Form -->
                <section class="dashboard-section">
                    <div class="section-header">
                        <h2><i class="fas fa-plus-circle"></i> Add New Project</h2>
                        <p>Add research projects to your portfolio</p>
                    </div>
                    
                    <form class="project-form" id="projectForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="projectTitle">Project Title *</label>
                                <input type="text" id="projectTitle" required 
                                       placeholder="e.g., Antimicrobial Resistance Study">
                            </div>
                            
                            <div class="form-group">
                                <label for="projectType">Project Type</label>
                                <select id="projectType">
                                    <option value="research">Research</option>
                                    <option value="lab">Lab Work</option>
                                    <option value="academic">Academic</option>
                                    <option value="clinical">Clinical</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="projectDescription">Description *</label>
                            <textarea id="projectDescription" required rows="4"
                                      placeholder="Detailed project description..."></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="projectTags">Tags (comma separated)</label>
                                <input type="text" id="projectTags" 
                                       placeholder="microbiology, research, lab">
                            </div>
                            
                            <div class="form-group">
                                <label for="projectStatus">Status</label>
                                <select id="projectStatus">
                                    <option value="ongoing">Ongoing</option>
                                    <option value="completed">Completed</option>
                                    <option value="planning">Planning</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="projectLink">External Link</label>
                                <input type="url" id="projectLink" 
                                       placeholder="https://example.com/project">
                            </div>
                            
                            <div class="form-group">
                                <label for="projectDate">Date</label>
                                <input type="date" id="projectDate" 
                                       value="${new Date().toISOString().split('T')[0]}">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>File Attachment</label>
                            <div class="file-upload-area" id="fileUploadArea">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Drag & drop files or <span>browse</span></p>
                                <input type="file" id="fileInput" hidden>
                                <p class="file-info">Max size: 10MB • PDF, DOC, Images</p>
                            </div>
                        </div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="featuredProject">
                            <label for="featuredProject">Mark as Featured Project</label>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Save Project
                            </button>
                            <button type="reset" class="btn btn-outline" id="clearBtn">
                                <i class="fas fa-times"></i>
                                Clear Form
                            </button>
                        </div>
                    </form>
                </section>
                
                <!-- Projects List -->
                <section class="dashboard-section">
                    <div class="section-header">
                        <h2><i class="fas fa-list"></i> Manage Projects</h2>
                        <p>Existing projects in your portfolio</p>
                    </div>
                    
                    <div class="projects-list-container">
                        <div class="list-header">
                            <span>Title</span>
                            <span>Date</span>
                            <span>Status</span>
                            <span>Actions</span>
                        </div>
                        
                        <div class="projects-list" id="projectsList">
                            <!-- Projects loaded dynamically -->
                            <div class="loading-projects">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Loading projects...</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                <div class="actions-grid">
                    <button class="action-btn" onclick="adminAuth.exportProjects()">
                        <i class="fas fa-download"></i>
                        Export Projects
                    </button>
                    <button class="action-btn" onclick="adminAuth.backupData()">
                        <i class="fas fa-database"></i>
                        Backup Data
                    </button>
                    <button class="action-btn" onclick="cmsManager.backupAllData()">
                        <i class="fas fa-save"></i>
                        Backup Website
                    </button>
                    <button class="action-btn" onclick="window.print()">
                        <i class="fas fa-print"></i>
                        Print Report
                    </button>
                    <a href="index.html" class="action-btn" target="_blank">
                        <i class="fas fa-eye"></i>
                        View Portfolio
                    </a>
                    <button class="action-btn" onclick="cmsManager.resetToDefaults()">
                        <i class="fas fa-undo"></i>
                        Reset Settings
                    </button>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="dashboard-footer">
            <div class="footer-content">
                <p><i class="fas fa-shield-alt"></i> Secure Admin Session Active</p>
                <p class="session-info">
                    Last activity: <span id="lastActivity">Just now</span> • 
                    Auto logout in: <span id="logoutTimer">119:00</span>
                </p>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="js/admin-auth.js"></script>
    <script src="js/cms-manager.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        updateProjectCount();
        updateSessionTimer();
        setupFileUpload();
        updateStorageUsage();
        
        // Set username from session
        const sessionData = JSON.parse(localStorage.getItem('adminSession') || '{}');
        if (sessionData.username) {
            document.getElementById('adminUsername').textContent = sessionData.username;
        }
    });
    
    function updateProjectCount() {
        const projects = JSON.parse(localStorage.getItem('portfolioProjects') || '[]');
        document.getElementById('projectsCount').textContent = projects.length;
    }
    
    function updateSessionTimer() {
        const sessionData = JSON.parse(localStorage.getItem('adminSession') || '{}');
        if (!sessionData.expires) return;
        
        function update() {
            const now = Date.now();
            const timeLeft = sessionData.expires - now;
            
            if (timeLeft <= 0) {
                adminAuth.handleLogout();
                return;
            }
            
            const minutes = Math.floor(timeLeft / 60000);
            const seconds = Math.floor((timeLeft % 60000) / 1000);
            
            document.getElementById('logoutTimer').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            const lastActivity = sessionData.timestamp ? 
                Math.floor((now - sessionData.timestamp) / 60000) : 0;
            document.getElementById('lastActivity').textContent = 
                `${lastActivity} minute${lastActivity !== 1 ? 's' : ''} ago`;
        }
        
        update();
        setInterval(update, 1000);
    }
    
    function setupFileUpload() {
        const uploadArea = document.getElementById('fileUploadArea');
        const fileInput = document.getElementById('fileInput');
        
        if (!uploadArea || !fileInput) return;
        
        uploadArea.addEventListener('click', () => fileInput.click());
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            uploadArea.classList.add('highlight');
        }
        
        function unhighlight() {
            uploadArea.classList.remove('highlight');
        }
        
        uploadArea.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            fileInput.files = files;
            
            if (files.length > 0) {
                const file = files[0];
                uploadArea.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <p>${file.name} (${formatFileSize(file.size)})</p>
                    <p class="file-info">Ready to upload</p>
                `;
                uploadArea.style.borderColor = '#28a745';
                uploadArea.style.background = '#f0fff4';
            }
        }
        
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                uploadArea.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <p>${file.name} (${formatFileSize(file.size)})</p>
                    <p class="file-info">Ready to upload</p>
                `;
                uploadArea.style.borderColor = '#28a745';
                uploadArea.style.background = '#f0fff4';
            }
        });
    }
    
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    function updateStorageUsage() {
        let total = 0;
        
        for (let key in localStorage) {
            if (localStorage.hasOwnProperty(key)) {
                total += localStorage[key].length * 2;
            }
        }
        
        document.getElementById('storageUsed').textContent = formatFileSize(total);
    }
    
    window.exportProjects = function() {
        const projects = JSON.parse(localStorage.getItem('portfolioProjects') || '[]');
        const dataStr = JSON.stringify(projects, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `projects-backup-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        adminAuth.showMessage('Projects exported successfully', 'success');
    };
    
    window.backupData = function() {
        const backup = {
            projects: JSON.parse(localStorage.getItem('portfolioProjects') || '[]'),
            timestamp: new Date().toISOString(),
            version: '1.0.0'
        };
        
        const dataStr = JSON.stringify(backup, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `portfolio-backup-${new Date().getTime()}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        adminAuth.showMessage('Full backup completed', 'success');
    };
    </script>
</body>
</html>